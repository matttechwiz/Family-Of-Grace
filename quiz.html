<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Family of Grace Quiz</title>
  <link rel="icon" type="image/x-icon" href="./photo_2025-09-03_01-35-31-removebg-preview.png">
  <style>
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .overlay .card { max-width: 400px; width: 100%; }
    .logo img{ height: 40px; width: 40px; }

    :root{
      --brand:#5b8def;
      --brand-dark:#3b6fd6;
      --text:#0f172a;
      --muted:#64748b;
      --bg:#f8fafc;
      --card:#ffffff;
      --accent:#22c55e;
      --danger:#ef4444;
      --warning:#f59e0b;
      --radius:18px;
      --shadow: 0 10px 30px rgba(2,6,23,.08);
    }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,Helvetica,sans-serif;
      color:var(--text);
      background:var(--bg);
      line-height:1.6;
    }

    .container{ width:min(1100px, 92%); margin-inline:auto; }

    .navbar{
      position:sticky; top:0; z-index:50;
      background:rgba(248,250,252,.8);
      backdrop-filter: blur(8px);
      border-bottom:1px solid #e2e8f0;
    }
    .navbar .inner{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 0;
    }
    .brand{
      display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.3px;
    }
    .brand .logo{
      width:38px; height:38px; display:grid; place-items:center; border-radius:12px; 
      background:linear-gradient(135deg,var(--brand),#93c5fd);
      color:white; font-weight:900; box-shadow:var(--shadow);
    }
    .nav-links{display:flex; gap:18px; align-items:center;}
    .nav-links a{
      text-decoration:none; color:var(--text); font-weight:600; padding:10px 14px; border-radius:12px;
    }
    .nav-links a.cta{
      background:var(--brand); color:white; box-shadow:var(--shadow);
    }
    .nav-links a:hover{background:#e2e8f0}

    .hero{
      display:grid; grid-template-columns:1.2fr .8fr; gap:28px; align-items:center;
      padding:56px 0 24px;
    }
    .hero h1{
      font-size:clamp(32px, 3.8vw, 54px);
      line-height:1.1; margin:0 0 12px;
    }
    .hero p{color:var(--muted); font-size:18px; margin:0 0 22px}
    .hero .card{
      background:var(--card); border-radius:var(--radius); padding:22px; box-shadow:var(--shadow);
    }

    .grid-3{ display:grid; grid-template-columns:repeat(3,1fr); gap:18px; }
    .card{ background:var(--card); border-radius:var(--radius); padding:20px; box-shadow:var(--shadow); }

    .section{padding:40px 0}
    .section h2{font-size:28px; margin:0 0 14px}
    .muted{color:var(--muted)}

    .list{ display:grid; gap:10px; }
    .badge{
      display:inline-block; padding:6px 10px; border-radius:999px; font-size:12px;
      background:#e2e8f0; color:#0f172a; font-weight:700; letter-spacing:.3px;
    }

    .footer{
      margin-top:40px; padding:24px 0; border-top:1px solid #e2e8f0; color:var(--muted);
    }

    .timer{
      height:10px; background:#e2e8f0; border-radius:999px; overflow:hidden;
    }
    .timer .bar{height:100%; width:100%; background:var(--accent); transition:width .3s linear}

    .btn{
      border:0; padding:12px 16px; border-radius:12px; font-weight:700;
      background:var(--brand); color:white; cursor:pointer; box-shadow:var(--shadow);
    }
    .btn.secondary{background:#e2e8f0; color:#0f172a}
    .btn.danger{background:var(--danger)}
    .btn.warning{background:var(--warning)}
    .btn:disabled{opacity:.6; cursor:not-allowed}

    @media (max-width: 920px){
      .hero{grid-template-columns:1fr; padding-top:32px; text-align:center;}
      .grid-3{grid-template-columns:1fr}
    }

    @media (max-width: 520px){
      .nav-links{display:none}
    }
  </style>
</head>
<body>
  <header class="navbar">
    <div class="container inner">
      <a class="brand" href="index.html">
        <div class="logo"><img src="./photo_2025-09-03_01-35-31-removebg-preview.png" alt=""></div>
        <div>Family of Grace</div>
      </a>
      <nav class="nav-links">
        <a href="index.html">Home</a>
      </nav>
    </div>
  </header>

  <!-- Login Overlay -->
  <div class="overlay" id="loginOverlay">
    <div class="card" style="padding:20px; text-align:center">
      <h2>Enter Details</h2>
      <p class="muted">Provide your name and access code to start</p>
      <input type="text" id="playerName" class="input" placeholder="Your Name" style="width:100%;margin-bottom:10px">
      <input type="text" id="playerCode" class="input" placeholder="Access Code" style="width:100%;margin-bottom:10px">
      <button id="startBtn" class="btn" style="width:100%">Start Quiz</button>
    </div>
  </div>

  <main class="container" style="display:none" id="quizMain">
    <section class="section">
      <div class="badge">FAMILY OF GRACE MONTHLY BIBLE QUIZ • RUTH</div>
      <h1>Answer 21 questions in 900 seconds</h1>
      <p class="muted" style="color:red;">Questions are randomly drawn from the Book of RUTH.<br>NOTE: Submit a screenshot of your score</p>

      <div class="card" style="display:grid; gap:14px">
        <div class="timer"><div id="bar" class="bar"></div></div>
        <div style="display:flex; gap:10px; align-items:center; justify-content:space-between">
          <div><strong>Time Left: <span id="timeLeft">900</span>s</strong></div>
          <div class="muted">Score: <span id="scoreNow">0</span>/21</div>
        </div>

        <!-- Multiple-choice quiz form -->
        <form id="quizForm" class="list" autocomplete="off"></form>

        <div style="display:flex; gap:10px">
          <button id="submitBtn" class="btn">Submit Answers</button>
          <button id="retryBtn" class="btn secondary" type="button"></button>
        </div>
      </div>
      <div id="result" class="notice" style="display:none"></div>
    </section>

    <section class="section">
      <h2>Participants Results</h2>
      <div class="card" style="overflow:auto">
        <table class="table" id="resultsTable">
          <thead>
            <tr>
              <th>Pos</th>
              <th>Name</th>
              <th>Code</th>
              <th>Score</th>
              <th>Time Used (s)</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody id="resultsBody"></tbody>
        </table>
      </div>
      <button id="exportResultsBtn" class="btn warning" style="margin-top:10px">Export Results CSV</button>
    </section>
  </main>

  <footer class="footer">
    <div class="container">© <span id="year"></span> Family of Grace</div>
  </footer>

<script>
document.getElementById('year').textContent = new Date().getFullYear();

// === Codes ===
const VALID_CODES = [
  "FG171","FG122","FG193","FG425","FG149",
  "FG432","FG782","FG800","FG042","FG510",
  "FG191","FG182","FG163","FG414","FG195",
  "FG116","FG149","FG148","FG119","FG530"
];

// === Quiz Questions ===
const BANK = [
  { q: "What was the name of Elimelech's hometown in Judah where he lived before going to Moab?", options: ["Bethlehem-judah","Jerusalem","Hebron","Ramah"], a: 0 },
  { q: "How long did Naomi's family dwell in the country of Moab before her sons died?", options: ["Five years","Seven years","About ten years","Twelve years"], a: 2 },
  { q: "What were the names of Elimelech and Naomi's two sons?", options: ["Mahlon and Chilion","Mahlon and Boaz","Chilion and Obed","Mahlon and Obed"], a: 0 },
  { q: "Which daughter-in-law did Naomi kiss before she returned to her people?", options: ["Ruth","Orpah","Both Ruth and Orpah","Neither of them"], a: 1 },
  { q: "What specific reason did Naomi give to discourage her daughters-in-law from following her?", options: ["She had no more sons in her womb to be their husbands","She was too poor to support them","They would be outcasts in Israel","The journey was too dangerous"], a: 0 },
  { q: "What name did Naomi ask to be called when she returned to Bethlehem, and what does it mean?", options: ["Naomi, meaning pleasant","Mara, meaning bitter","Ruth, meaning compassionate","Orpah, meaning back of neck"], a: 1 },
  { q: "At what time of year did Naomi and Ruth arrive in Bethlehem?", options: ["At the beginning of wheat harvest","At the beginning of barley harvest","At the end of harvest season","During the grape harvest"], a: 1 },
  { q: "How is Boaz described in relation to Elimelech?", options: ["A distant cousin","A brother","A mighty man of wealth and a kinsman of Elimelech's","Elimelech's nephew"], a: 2 },
  { q: "What did Ruth ask Naomi for permission to do?", options: ["Go to the marketplace","Go to the field and glean ears of corn after someone in whose sight she would find grace","Go to the well to draw water","Go to the city gate"], a: 1 },
  { q: "What greeting did Boaz give to his reapers when he came from Bethlehem?", options: ["\"Peace be with you\"","\"The Lord bless you\"","\"Grace and peace\"","\"God be with you\""], a: 1 },
  { q: "What did Boaz command his young men NOT to do to Ruth?", options: ["Not to speak to her","Not to rebuke her","Not to touch her","Not to allow her to glean"], a: 2 },
  { q: "What specific instruction did Boaz give his young men regarding Ruth's gleaning?", options: ["To give her the best grain","To let fall some handfuls of purpose for her","To help her gather grain","To share their lunch with her"], a: 1 },
  { q: "How much barley did Ruth glean and beat out that day?", options: ["Half an ephah","About an ephah","Two ephahs","Three ephahs"], a: 1 },
  { q: "What did Ruth give to Naomi after she had eaten and was sufficed?", options: ["Money from selling grain","Bread from Boaz","What she had reserved after she was sufficed","A gift from the reapers"], a: 2 },
  { q: "What did Naomi tell Ruth that Boaz would be doing that night?", options: ["Threshing wheat","Winnowing barley in the threshing floor","Counting his grain","Celebrating the harvest"], a: 1 },
  { q: "What did Naomi instruct Ruth to do before going to the threshing floor?", options: ["Take food and drink","Wash herself, anoint herself, and put on her raiment","Tell Boaz she was coming","Bring offerings to the Lord"], a: 1 },
  { q: "According to Naomi's instructions, when should Ruth make herself known to Boaz?", options: ["As soon as she arrived at the threshing floor","When he was eating","After he had finished eating and drinking","In the morning"], a: 2 },
  { q: "Where specifically did Naomi tell Ruth to lie down?", options: ["At Boaz's head","At Boaz's feet","Near the door","By the grain pile"], a: 1 },
  { q: "At what time did Boaz discover Ruth lying at his feet?", options: ["At sunset","At midnight","At dawn","In the early evening"], a: 1 },
  { q: "What reason did Boaz give for blessing Ruth for coming to him?", options: ["Because she showed kindness in not going after young men, whether poor or rich","Because she was faithful to Naomi","Because she worked hard in the fields","Because she was humble and obedient"], a: 0 },
  { q: "How much barley did Boaz measure out for Ruth before she left in the morning?", options: ["Three measures of barley","Six measures of barley","Ten measures of barley","Twelve measures of barley"], a: 1 }
];

const TOTAL = 21;
let picked = [];
let timer = 900;
let intervalId = null;
let currentPlayer = null;
let quizStartTime = null;

const form = document.getElementById('quizForm');
const submitBtn = document.getElementById('submitBtn');
const retryBtn = document.getElementById('retryBtn');
const timeLeft = document.getElementById('timeLeft');
const bar = document.getElementById('bar');
const result = document.getElementById('result');
const scoreNow = document.getElementById('scoreNow');
const resultsBody = document.getElementById('resultsBody');

const STORAGE_KEY = "fg_quiz_results";

// shuffle helper
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr; }

function pickQuestions(){ const ids=[...Array(BANK.length).keys()]; shuffle(ids); return ids.slice(0,TOTAL).map(i=>BANK[i]); }

function renderQuiz(){
  picked = pickQuestions();
  form.innerHTML = "";
  picked.forEach((item,idx)=>{
    const name="q"+idx;
    const block=document.createElement("div");
    block.className="card";
    block.innerHTML=`<strong>Q${idx+1}.</strong> ${item.q}`;
    const list=document.createElement("div");
    list.className="list";
    item.options.forEach((opt,oi)=>{
      const id=`${name}_${oi}`;
      const row=document.createElement("label");
      row.style.display="flex";
      row.style.alignItems="center";
      row.style.gap="10px";
      row.innerHTML=`<input type="radio" name="${name}" value="${oi}" id="${id}"><span>${opt}</span>`;
      list.appendChild(row);
    });
    block.appendChild(list);
    form.appendChild(block);
  });
  scoreNow.textContent="0";
  result.style.display="none";
  submitBtn.disabled=false;
}

function startTimer(){
  clearInterval(intervalId);
  timer=900;
  timeLeft.textContent=timer;
  bar.style.width="100%";
  quizStartTime = Date.now();
  intervalId=setInterval(()=>{
    timer--;
    timeLeft.textContent=timer;
    const pct = Math.max(0,(timer/900)*100);
    bar.style.width=pct+"%";
    if(timer<=0){ clearInterval(intervalId); grade(true); }
  },1000);
}

function grade(auto=false){
  clearInterval(intervalId);
  let score=0;
  picked.forEach((item,idx)=>{
    const radios=form.querySelectorAll(`input[name="q${idx}"]`);
    let chosen=-1;
    radios.forEach(r=>{if(r.checked)chosen=parseInt(r.value);});
    const correct=item.a;
    radios.forEach((r,oi)=>{
      const label=r.parentElement;
      label.style.padding="6px 10px";
      label.style.borderRadius="10px";
      if(oi===correct){ label.style.background="rgba(34,197,94,.15)"; label.style.border="1px solid rgba(34,197,94,.35)"; label.style.fontWeight="600";}
      if(oi===chosen && chosen!==correct){ label.style.background="rgba(239,68,68,.12)"; label.style.border="1px solid rgba(239,68,68,.35)";}
    });
    if(chosen===correct)score++;
  });
  scoreNow.textContent=String(score);
  submitBtn.disabled=true;
  const msg=auto?"Time is up!":"Submitted.";
  result.style.display="block";
  result.innerHTML=`<strong>${msg}</strong> You scored <strong>${score}</strong> out of <strong>${TOTAL}</strong>.`;
  const timeUsed = Math.floor((Date.now()-quizStartTime)/1000);

  // Save result
  const raw=localStorage.getItem(STORAGE_KEY);
  const data=raw?JSON.parse(raw):[];
  data.push({ name: currentPlayer.name, code: currentPlayer.code, score, time: timeUsed, date: new Date().toLocaleString() });
  localStorage.setItem(STORAGE_KEY,JSON.stringify(data));
  loadResults();
}

function loadResults(){
  const raw=localStorage.getItem(STORAGE_KEY);
  const data=raw?JSON.parse(raw):[];
  data.sort((a,b)=>{ if(b.score!==a.score) return b.score-a.score; return a.time-b.time; });
  resultsBody.innerHTML="";
  data.forEach((rec,i)=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${i+1}</td><td>${escapeHtml(rec.name)}</td><td>${escapeHtml(rec.code)}</td><td>${rec.score}</td><td>${rec.time}</td><td>${rec.date}</td>`;
    resultsBody.appendChild(tr);
  });
}

function exportCSV(){
  const raw=localStorage.getItem(STORAGE_KEY);
  if(!raw){alert("No records");return;}
  const data=JSON.parse(raw);
  const headers=["Pos","Name","Code","Score","Time Used","Date"];
  const rows=[headers];
  data.sort((a,b)=>{ if(b.score!==a.score) return b.score-a.score; return a.time-b.time; })
      .forEach((rec,i)=>{ rows.push([i+1,rec.name,rec.code,rec.score,rec.time,rec.date]); });
  const csv=rows.map(r=>r.map(cell=>`"${(cell===undefined||cell===null)?"":cell}"`).join(",")).join("\n");
  const blob=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="quiz_results.csv";
  document.body.appendChild(a);
  a.click();
  a.remove();
}

function escapeHtml(text){ if(text===undefined||text===null)return""; return String(text).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;"); }

// Events
submitBtn.addEventListener("click",e=>{ e.preventDefault(); grade(false); });
retryBtn.addEventListener("click",()=>{ renderQuiz(); startTimer(); });
document.getElementById("exportResultsBtn").addEventListener("click",exportCSV);

document.getElementById("startBtn").addEventListener("click",()=>{
  const name=document.getElementById("playerName").value.trim();
  const code=document.getElementById("playerCode").value.trim();
  if(!name||!code){alert("Enter name and code");return;}
  if(!VALID_CODES.includes(code)){alert("Invalid code");return;}
  currentPlayer={name,code};
  document.getElementById("loginOverlay").style.display="none";
  document.getElementById("quizMain").style.display="block";
  renderQuiz();
  startTimer();
  loadResults();
});

loadResults();
</script>
</body>
</html>
